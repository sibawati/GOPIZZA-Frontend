<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOPIZZA Ratings Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <h2>GOPIZZA Zomato Ratings Dashboard</h2>
    
    <div id="restaurantList" class="restaurant-list"></div>

    <script>
        const API_URL = "https://gopizza-backend.onrender.com/restaurants";

        function fetchRestaurants() {
            fetch(API_URL)
                .then(res => res.json())
                .then(data => {
                    let list = document.getElementById("restaurantList");
                    list.innerHTML = "";

                    data.forEach(r => {
                        let div = document.createElement("div");
                        div.className = "restaurant-item";
                        div.innerHTML = `
                            <span>${r.name} - <a href="${r.zomatoUrl}" target="_blank">View on Zomato</a> 
                            <span class="rating" id="rating-${r.id}">Loading...</span></span>
                        `;
                        list.appendChild(div);

                        fetch(`https://gopizza-backend.onrender.com/ratings/${r.id}`)
                            .then(res => res.json())
                            .then(scrapedData => {
                                let ratingText = scrapedData.ratings ? `⭐ Dine-in: ${scrapedData.ratings.dine_in} | Delivery: ${scrapedData.ratings.delivery}` : "No ratings available";
                                document.getElementById(`rating-${r.id}`).textContent = ratingText;
                            })
                            .catch(() => {
                                document.getElementById(`rating-${r.id}`).textContent = "Failed to load";
                            });
                    });
                })
                .catch(error => console.error("Error fetching restaurants:", error));
        }

        fetchRestaurants();
    </script>
</body>
</html>
